<html>
<head>
<title>Frank's Awesome Media Player</title>
<style>

button {
  border: 1px solid black;
  border-radius: 0;
  box-shadow: none;
  background: none;
  margin: 0.2em 0.4em 0.2em 0;
  padding: 0.2em 0.6em;
  font-size: 4em;
}

input[type="range"] {
  width: 90vw;
  margin: 1vh 2vh;
  height: 4vh;
  background: #ccc;
  appearance: none;
}

input[type="range"]::-webkit-range-thumb {
  background-color: #acf;
  appearance: none;
  width: 2em;
  height: 4vh;
}

input[type="range"]::-webkit-slider-thumb {
  background-color: #acf;
  appearance: none;
  width: 2em;
  height: 4vh;
}

a {
  font-size: 3em;
  display: block;
  text-decoration: none;
  border: 1px solid black;
  width: fit-content;
  margin: 0.6em 0;
  padding: 0.2em 0.4em;
  color: black;
}

a:hover {
  filter: saturate(2) brightness(0.8);
}

</style>
</head>

<body>
<p style='font-size: 3em' id='playing'></p>
<input id='volume' oninput="fetch('/volume?to=' + this.value)" type='range' min=0 max=100 value=30>
<p>
  <button onclick="fetch('/pause')">Pause</button>
  <button onclick="fetch('/next')">Next</button>
  <button id='play'>Play</button>
</p>
<p>
  <button id='inside' onclick="fetch('/mute?side=in')">In</button>
  <button id='outside' onclick="fetch('/mute?side=out')">Out</button>
</p>
<div id='list'></div>
<script>
let params = new URLSearchParams(window.location.search)
let path = params.get("path") != null ? (params.get("path") + "/") : "/"
fetch(`/list?path=${path}`).then(r=>r.json()).then(r=>{
  document.getElementById("list").innerHTML = r.sort()
    .map((x,i)=>`<a style="background: hsl(${(i*37)%360}, 100%, 90%)" `
              + `href="?path=${path}${encodeURIComponent(x)}">${x}</a>`).join("\n")
})

let pb = document.getElementById("play")
pb.addEventListener("click", ()=>{
  fetch(`/play?path=${path}`); 
})
;[...document.getElementsByTagName("button")].forEach(x=>x.addEventListener("click", (e)=>{
  setTimeout(()=>{e.target.style.background='none'}, 250); 
  e.target.style.background='#aaa'
}))

setInterval(()=>{
  fetch("/state").then(r=>r.json()).then(r=>{
    document.getElementById("inside").style.background = r.in ? "#cfc" : "#fcc"
    document.getElementById("outside").style.background = r.out ? "#cfc" : "#fcc"
    document.getElementById("volume").value = r.vol
    document.getElementById("playing").innerHTML = r.file
})}, 1500)
</script>
</body>
</html>
